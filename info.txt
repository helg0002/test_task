Используются сущности:
Lead
 - Идентифицирует уникального клиента/обращение
 - Связан с контактами через lead_id

Source (источник)
 - Канал, из которого пришёл лид
 - Связан с контактами через source_id
 - Для каждого источника задаются веса операторов

Operator (оператор)
 - Сотрудник, который обрабатывает обращения.
 - Имеет атрибуты: alive (активен/неактивен), limit (максимальное количество активных контактов), active_contacts (текущее количество назначенных лидов)

Contact (контакт)
 - Конкретное обращение, связанное с лидом и источником
 - Может быть назначено оператору (operator_id)


Связи:
 - Lead /Contact (один ко многим)
 - Source/Contact (один ко многим)
 - Operator/Contact (один ко многим)




Алгоритм
Определение лида
 - Если приходит обращение с external_id система проверяет, существует ли лид с таким идентификатором
 - Если лид уже есть, новое обращение связывается с ним
 -Если нет то создаётся новый лид
Выбор источника
 - Проверяется наличие источника (source_id)
 - Если источник не найден то возвращается ошибка 404
Назначение оператора
 - Для данного источника выбираются операторы с ненулевым весом
 - Вес отражает приоритет: чем выше вес, тем выше вероятность назначения
 - Из списка кандидатов выбирается оператор с учётом весов
Учёт лимитов нагрузки
 - У каждого оператора есть limit  максимальное количество активных контактов
 - Если active_contacts больше или равно limit, оператор исключается из кандидатов
 - При назначении контакта счётчик active_contacts увеличивается на 1
 Если подходящих операторов нет
 - Контакт создаётся без назначенного оператора (operator_id = None)
 - В ответе API поле "assigned": False

Итог
 - Обращения группируются по external_id  то есть один лид может иметь несколько контактов
 - Операторы выбираются по весам, но только если они активны и не превысили лимит
 - Если ни один оператор не подходит, обращение остаётся без назначения
